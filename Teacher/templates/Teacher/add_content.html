{% extends 'Teacher/teachers_base.html' %}
{% block content %}


<br><br><br><br>
<div class="container" >
    <form id="upload-form" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <select class="form-select" name="subtopic">
            {% for subtopic in subtopics %}
                <option value="{{ subtopic.id }}">{{ subtopic.name }}</option>
            {% endfor %}
        </select>
        <br>
        
        <input class="form-control" type="text" name="title" placeholder="Enter Title">
        <br>
        
        <input name="file" type="file" class="form-control" id="file">
        <br>
        
        <button class="btn btn-primary" type="submit">Upload</button>
        
        <!-- Progress Bar -->
        <div class="progress mt-3" style="display: none;">
            <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
            </div>
        </div>
        
        <p id="upload-status" class="mt-2 text-success"></p>
    </form>
    

        <script>
            document.getElementById("upload-form").addEventListener("submit", function(event) {
                event.preventDefault();  // Prevent default form submission
                
                let formData = new FormData(this);
                let xhr = new XMLHttpRequest();
                
                xhr.open("POST", window.location.href, true);
                xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
        
                // Show progress bar
                document.querySelector(".progress").style.display = "block";
                
                // Track progress
                xhr.upload.addEventListener("progress", function(e) {
                    if (e.lengthComputable) {
                        let percent = Math.round((e.loaded / e.total) * 100);
                        document.getElementById("progress-bar").style.width = percent + "%";
                        document.getElementById("progress-bar").setAttribute("aria-valuenow", percent);
                    }
                });
        
                // When upload is complete
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        document.getElementById("upload-status").textContent = "Upload Successful!";
                        document.getElementById("progress-bar").classList.add("bg-success");
                    } else {
                        document.getElementById("upload-status").textContent = "Upload Failed. Try Again.";
                        document.getElementById("progress-bar").classList.add("bg-danger");
                    }
                };
        
                xhr.send(formData);
            });
        </script>
        



</div>
{% endblock %}